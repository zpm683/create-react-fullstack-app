import { Meta } from "@storybook/addon-docs/blocks";

<Meta title="React/2 React核心/2.4 组件与Hooks" />

## 组件与 Hooks（闭包）

1.4.1 React 组件
在 React 的世界里，组件类型分为两种。
一种是 class 式组件（以下简称 CC），一种是函数式组件（以下简称 FC）。

- 相同点：
  都是 React 组件。
  都有 state，props，context 等基本的 react 概念
  ...

- 核心不同点：
  CC 有生命周期，FC 没有
  CC 需要实例化，FC 不需要
  CC 中存在 this，FC 中没有
  同功能的组件，CC 比 FC 复杂
  ...

从长远的角度看，推荐使用 FC（函数式组件）。  
FC 通常比 CC 更加高效,灵活, 是函数式编程的一个实践！  
那么，何时使用 CC？  
当你需要严格控制各种生命周期或者 FC 无法满足特殊需求时，再考虑使用 CC。  
（比如）[错误边界](https://react.docschina.org/docs/error-boundaries.html)

---

FC 的出现促生了 Hooks（钩子）这个概念。
Hooks 又是什么？请先看看官方介绍。  
[官方介绍](https://react.docschina.org/docs/hooks-intro.html)

---

1.4.2 Hooks！

- 基本概念
  Hooks 是 React 16.8 的新增特性。  
  它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性。  
  常用 Hooks 有
- [useState](https://react.docschina.org/docs/hooks-state.html)
- [useEffect](https://react.docschina.org/docs/hooks-effect.html)
- [useRef](https://react.docschina.org/docs/hooks-reference.html#useref)
- [useCallback](https://react.docschina.org/docs/hooks-reference.html#usecontext)
- [useMemo](https://react.docschina.org/docs/hooks-reference.html#useMemo)
- [useReducer](https://react.docschina.org/docs/hooks-reference.html#useReducer)
- [useContext](https://react.docschina.org/docs/hooks-reference.html#useContext)
- [useLayoutEffect](https://react.docschina.org/docs/hooks-reference.html#useLayoutEffect)

另外社区中还衍生出了更多 API：[react-use](https://github.com/streamich/react-use)  
这里具体介绍一下前 5 个 API：

- 自定义 Hooks
  如何像 react-use 一样定义一个自己的 Hooks 呢？  
  起始非常简单！这里直接通过一个例子讲解！  
  现在假设我们需要一个叫 useOnline 的自定义 Hooks，  
  我们希望 useOnline 可以返回当前的网络状态。

定义 useOnline 钩子

```javascript
import { useState, useEffect } from "react";
// 返回当前的网络状态钩子
export const useOnline = () => {
  // 使用useState创建一个isOnline状态，并初始化。
  const [isOnline, setNetwork] = useState(window.navigator.onLine);
  // 更新状态的方法
  const updateNetwork = () => {
    setNetwork(window.navigator.onLine);
  };
  // 组件重新渲染时再次获取最新网络状态
  useEffect(() => {
    window.addEventListener("offline", updateNetwork);
    window.addEventListener("online", updateNetwork);
    // 组件卸载时解除绑定
    return () => {
      window.removeEventListener("offline", updateNetwork);
      window.removeEventListener("online", updateNetwork);
    };
  });
  // 返回最新isOnline状态
  return isOnline;
};
```

使用 useOnline 钩子

```javascript
import React from "react";
import { useOnline } from "./hooks";

const DemoWithOnline = () => {
  // 通过useOnline自定义hook获取网络状态
  // isOnline其实是一种state
  const isOnline = useOnline();
  return <h1>{isOnline ? "在线" : "离线"}</h1>;
};
```

这就是一个自定义钩子了，过程其实大同小异。
如果你是一个 JS 高手，从上面的例子其实就可以看出
Hooks & 自定义 Hooks 本质是闭包！
如果你不懂什么是闭包，请务必学习
[闭包的概念](http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html)
我相信如果你熟悉闭包，那么就能轻易的定义自己的钩子！
