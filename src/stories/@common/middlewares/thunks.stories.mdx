import { Meta } from "@storybook/addon-docs/blocks";

<Meta title="@common/middlewares/thunks" />

## 自定义 thunks 文件夹

thunks 用于 redux, 用于定义异步 actions

### withLoading 中间件

使用 withLoading 定义一个异步 action 后，  
在异步方法执行时，会自动显示加载组件（LoadingShower）  
原理是自动的修改公共 @common/redux/loadingSlice 中所管理的全局加载状态和错误信息

#### 使用方法

在 reudx 中

```typescript
// doLoginApi是一个异步action
// RequestData是action传入的参数接口
export const doLoginApi = (params: RequestData): AppThunk =>
  // 使用withLoading
  // ResponseData是异步方法返回的结果集接口
  withLoading<ResponseData>(
    // 第一个参数是一个异步函数，自带 dispatch, getState参数
    async (dispatch, getState) => {
      // 固定格式 return await xxx(params);
      return await callLoginApi(params);
    },
    // 第二个参数是一个成功时的回调函数，自带 result, dispatch, getState参数
    (result, dispatch, getState) => {
      // result是返回结果
      console.log(`result${JSON.stringify(result)}`);
      // 可以发起其他action
      dispatch(setToken("test Token"));
    },
    // 第三个参数是一个出错时的回调函数，自带 errMsg, dispatch, getState参数
    (errMsg, dispatch, getState) => {
      // errMsg是异步方法返回的错误信息
      console.log(errMsg);
      // 可以做点其他事情
    },
  );
```
